# WARP.md

This file provides guidance to WARP (warp.dev) when working with code in this repository.

Project overview
- Purpose: Interactive web-based geological map visualization for Iran using Leaflet.js
- Technology: HTML5, CSS3, JavaScript (Leaflet.js, Esri Leaflet plugins)
- Data sources: ArcGIS Feature Servers for geological layers, local GeoJSON for mines data
- Integration: Visualizes data exported from the parent Mindat API scraper project

Architecture
- geodatafromesri.html: Main HTML page with embedded layer controls and map container
- geo-scripts.js: Core JavaScript handling map initialization, layer management, data fetching
- geo-style.css: Comprehensive styling for map interface, controls, and overlays
- iran_mines.geojson: Local GeoJSON data file containing Iranian mine locations from Mindat

Web application features
- Interactive geological map centered on Iran with bounded view
- Multi-layer visualization:
  - Oil & Gas Fields (ArcGIS Feature Server)
  - Earthquakes (filtered to Iran region)
  - Geologic Provinces and Formations
  - Cadaster tiles overlay
  - Mines data (from parent project's GeoJSON export)
- Layer opacity controls and visibility toggles
- Real-time feature information on hover
- Loading states and error handling
- Responsive design with custom styling

Common commands
- Serve the web application locally:
```bash path=null start=null
# From mbtiles directory
python -m http.server 8000
# Then visit http://localhost:8000/geodatafromesri.html
```
- Update mines data from parent project:
```bash path=null start=null
# From project root, run export script to generate fresh GeoJSON
cd scripts
python to_leaflet_geojson.py
# Copy result to mbtiles/iran_mines.geojson
cp iran_mines.geojson ../mbtiles/
```

Data layer sources
- Iran Geology Feature Server: `https://services.arcgis.com/v01gqwM5QqNysAAi/ArcGIS/rest/services/Iran_Geology/FeatureServer`
  - Layer 0: Oil & Gas Fields
  - Layer 1: Geologic Provinces  
  - Layer 2: Geology Formations
- Earthquake data: ESRI sample server with Iran bounding box filter
- Cadaster tiles: External tile service at `https://map.zetamine.ai/services/output/tiles/`
- Local mines: GeoJSON generated from parent project's Mindat API data

Key JavaScript components
- Map initialization with Iran-focused bounds and multiple base layers (OSM, Satellite, Terrain)
- Layer management system storing both raw Esri layers and processed layer groups
- Custom info panel showing feature details on hover with type-specific formatting
- Interactive layer toggles with opacity controls and visual indicators
- Error handling and loading states for external data sources
- Marker clustering support for point data visualization

Development notes
- The application assumes internet connectivity for external ArcGIS and tile services
- Iran geographic bounds are hardcoded: north: 39.5, south: 25.0, east: 63.5, west: 44.0
- Layer visibility and opacity state is managed through DOM controls and JavaScript objects
- Feature info extraction handles various property schemas from different data sources
- CSS uses backdrop filters and modern properties (may need polyfills for older browsers)

Integration with parent project
- Consumes iran_mines.geojson generated by scripts/to_leaflet_geojson.py
- Visualizes localities data scraped from Mindat API in geographic context
- Provides interactive exploration of mining sites alongside regional geological features
- Can be updated by re-running parent project exports and copying GeoJSON files
